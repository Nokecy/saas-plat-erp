# 采购订单

## 功能概述

采购订单是企业为购买货物或劳务，与供应商之间签订的单据，主要内容包括采购什么货物、采购数量、由谁供货，什么时间到货、到货地点、运输方式、价格、支付方式等。它可以是企业采购合同中关于货物的明细内容，也可以是一种订货的协议。

## 领域对象

**采购订单**

| 字段          | 说明                                             |
|--------------|--------------------------------------------------|
| 单据编号	     |                                                 |
| 单据日期	     | 业务发生日期，默认系统登录日期。	                  |
| 供应商	        | 采购订货的属性为“供应商”的[往来单位][5]。          |
| 部门	         | 参见部门档案                                     |
| 业务员	        | 属性为“业务员”的[员工信息][4]。                   |
| 项目	         | 参见[项目档案][3]                                |
| 预计到货日期	  | 签订订单时供应商承诺的到货日期                    |
| 币种           | 修改[币种][6]，原币的价税额不变，本位币根据汇率自动换算  |
| 汇率	         | 本位币汇率必须为１                               |
| 运输方式	    |                                                  |
| 到货地址	    | 收货的地址                                        |
| 联系人	       | 收货的联系人                                      |
| 联系电话	    | 收货的联系电话                                     |
| 合同号	        |                                                 |
| 付款方式	     | 参见[结算方式][7]                                 |
| 订金金额       | 签定订单时支付的预付款金额。                       |
| 销售订单号	    | 记录为哪个销售订单做的采购订单。                    |
| 来源单据	     | 流转生成当前单据的单据类型：销售订单、预测单、请购单。|
| 来源单号	     | 流转生成当前单据的单据编号。                       |

**订单明细**

| 字段          | 说明                                             |
|--------------|--------------------------------------------------|
| 条形码	        | 需要启用条码才显示                               |
| 项目	        | 参见项目档案                                     |
| 供应商存货	    | 参见供应商存货设置, 参照供应商存货设置中的已定义的供应商存货名称录入，参照带入后自动带出存货相关信息。 |
| 存货          |   属性为‘外购、劳务费用’的存货记录                 |
| 采购单位	     | 实际业务发生时的计量单位                          |
| 数量	         | 采购单位的数量。 参见[采购批量][21]               |
| 计量单位组合	  | 参见[多计量][1]                                 |
| 计量单位2	      ||
| 数量2	         ||
| 换算率	         ||
| 报价	          ||
| 折扣%	          ||
| 税率%           | 参见[存货档案][2]  手工填单时，带入存货档案上的税率，如果为空则带入[往来单位档案]中的税率。 ||
| 单价            | 可查询最近历史交易价格，参见历史价格查询，对应[采购单位]的单价。|
| 含税单价	      |  参见历史价格查询   |
| 金额	          ||
| 税额	          ||
| 含税金额	       ||
| 折扣金额	       ||
| 本币单价	       | 参见多币种 |
| 本币金额	       ||
| 本币税额	       ||
| 本币含税单价	    ||
| 本币含税金额	    ||
| 本币折扣金额	    ||
| 预计到货日期	    | 每行存货的预计到货日期 |
| 赠品	           | 参见赠品管理           |
| 销售订单号	       | 用于销售订单跟踪业务，未自动带入时，可手工指定。       |
| 来源单据	        | 流转生成当前单据的单据类型：销售订单、请购单、预测单。  |
| 来源单号	        | 流转生成当前单据的单据编号                           |


[1]: https://github.com/saas-plat/saas-plat-erp/tree/master/base/inventory/docs/多计量.md        "多计量"
[2]: https://github.com/saas-plat/saas-plat-erp/tree/master/base/inventory/README.md        "存货档案"
[3]: https://github.com/saas-plat/saas-plat-erp/tree/master/base/project/README.md        "项目"
[4]: https://github.com/saas-plat/saas-plat-erp/tree/master/base/employee/README.md        "员工档案"
[5]: https://github.com/saas-plat/saas-plat-erp/tree/master/base/partner/README.md        "往来单位"
[6]: https://github.com/saas-plat/saas-plat-erp/tree/master/base/currency/README.md        "币种汇率"
[7]: https://github.com/saas-plat/saas-plat-erp/tree/master/base/settlement/README.md        "结算方式"

[21]: https://github.com/saas-plat/saas-plat-erp/tree/master/base/inventory/README.md        "采购批量"
[22]: https://github.com/saas-plat/saas-plat-erp/tree/master/base/inventory/README.md        "配比采购"

## 业务规则

+ 新增
  - 新建订单
  - 选单：由请购单创建

+ 分单保存
  - 将存货按不同的默认供应商进行拆单保存

+ 配比采购
  - ~~参见[配比采购][22]，如果知道一个物料B的BOM结构，而需要采购的物料是组成B的零部件，此时可以采用配比采购功能，通过录入B物料及数量，系统自动分解B成相应零部件，数量自动计算~~
  - 通过‘分单保存’功能将存货按不同的默认供应商进行拆单保存。

+ 整单折扣
  - 作用：整单总金额抹零或向上取整的作用。例如：总金额10001.5，抹掉1.5（取整到10000）；总金额999.5，向上取整到1000，折扣掉（-0.5）（折扣金额0.5）。
  - 功能：对于单据总金额如果有零头或差点不足某个整数时，为了结算方便，往往向上或向下凑到整数，此时可以通过整单折扣金额工具将需要折扣掉的金额自动分摊到单据明细的折扣金额中，最终使整单总金额成为方便结算的数值。如果同一张单据多次调用此工具，则多次折扣掉的金额累计加在“折扣金额”字段中，即起折上折的作用。 劳务存货也当正常存货参与分摊。
  - 折扣金额范围：非0数值。
  - 分摊规则：
    - 若表头供应商非空：往来单位档案中“采购报价含税”=‘是’，则按明细原币含税金额比例分摊；否则按原币金额比例分摊；
    - 若表头供应商为空，按原币金额比例分摊。
    - 分摊到最后一笔用减法，将（整单折扣金额-已分摊金额合计）分摊到最后一条明细上。
    - 分摊后的原币折扣金额=原币折扣金额+分摊的折扣金额。

+ 变更
  - 通过此功能可以将已后续执行但未中止的订单进行部门信息的修改。
  - ‘备注’可变更。
  - 明细：对已后续执行的行只可修改数量，修改后的量应大于后续执行量中的最小值；对由来源单生成但未后续执行的行，除来源带入的字段不可改，其它不控制。

+ 协同
  - 自动生成平台供应商的订货单

+ 受金额字段权限控制的字段有
  - 报价、单价、含税单价、金额、税额、含税金额、折扣额、本币单价、本币金额、本币税额、本币含税单价、本币含税金额、订金金额。

+ 订金
  - 若订金金额不为空，则订单生效时，自动生成一张预付款单
  - 当采购订单日期小于启用日期或是已期末处理的会计期间日期时，不允许在采购订单上录入、修改订金。
  - 当采购订单没有审核环节时，修改订单的订单日期、订单编号、供应商、部门、业务员、币种、汇率、及订金的金额、结算方式、账号名称、票据号完后，保存，对于生成的付款单要同时自动修改。
