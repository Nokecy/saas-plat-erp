# 进货业务

进货单是根据供应商送来的存货，按着发货清单及质量检验结果（或根据已入库数量）填制的单据；进货单立账流程时，根据实际进货情况可以确定同供应商之间的应付关系，确定入库成本，进货单是应付款立账的依据。
按业务类型划分可以分为：普通采购、采购退货；可以处理普通采购进货的业务，也可以处理因为损坏、积压、换货等因素而产生的退货业务。

**退货业务**

根据采购退货的实际情况确定同供应商之间的应付关系及应付账款，并确定相应的退货成本。产生退货的原因可以是送货过程中损坏、库房积压、换货等。
退货可以分为普通退货、换货、冲抵进货的退货。退货单页面“□ 冲抵进货”复选框打勾为冲抵进货的退货业务，不打勾为普通退货业务，换货业务在“普通采购”的进货单上体现。
以下是几种退货的场景：
普通退货应用场景：不管是否做了入库、开票业务，因为不符合要求产生的退货都可以作普通退货。可以参照生成也可以手工填加，后续可以作相应的红字入库、红字开票业务。建议将已入库的退货采用此种方式。
冲抵进货的退货应用场景：已经收货了，即做了普通采购的进货单，但收到的货还没有全部入库或开票，此时对于既未入库又未开票的部分可以冲抵进货，冲抵的这部分存货后续不再作红字入库、红字开票业务；已做过入库或开票的部分不可以做冲抵。冲抵进货的退货单只能参照进货单生成，以便记录冲抵的哪一笔进货。
换货业务应用场景：不符合条件的存货返还给供应商，同时从供应商处得到符合条件的存货。此种换货业务，可以通过业务类型为“普通采购”的进货单明细正负混录实现：将不符合条件的存货在进货单上以负数形式录入，换回的符合条件的存货在同一进货单上以正数形式录入。换货业务的后续处理与普通退货相同。

## 领域对象

**进货单**

| 字段          | 说明                                             |
|---------------|--------------------------------------------------|
| 单据编号	 
| 单据日期	业务发生日期，默认系统登录日期
| 业务类型	普通采购、采购退货
| 票据类型	当前交易对应凭据的类型，如收据、发票，参见票据类型
| 发票号	当自动生成采购发票时，根据实际发票号填写
| 供应商	采购订货的供应商。属性为“供应商”或“供应商/客户”的往来单位。参见往来单位档案
| 应付余额	针对当前供应商的欠款总额。
| 部门	参见部门档案
| 业务员	属性为“业务员”的员工信息。参见员工档案
| 项目	参见项目档案
| 整单折扣%	辅助表体折扣快速录入，业务发生以表体折扣为准。
| 使用预付	进货单立账时，有此栏目。使用以前的预付款和付款一起核销应付款。
| 到货日期	 
| 付款到期日	此日期将影响付款预警、往来资金预测、账龄分析的准确度。参见结算方式
| 仓库	辅助表体仓库快速录入，业务发生以表体仓库为准。
| 币种	参见多币种修改币种，原币的价税额不变，本位币根据汇率自动换算。
| 汇率	本位币汇率必须为１
| 运输方式	 
| 到货地址	收货的地址
| 联系人	收货的联系人
| 联系电话	收货的联系电话
| 合同号	 
| 付款方式	参见结算方式
| 现结金额	收到货后现场付款金额。<br/>退货时小于等于0。参见多结算 <br/>采购发票立账时，无此栏目。
| 入库类别	参见出入库类别档案
| 销售订单号	参见销售订单跟踪
| 来源单据	流转生成当前单据的单据类型：采购入库单、采购订单。
| 来源单号	流转生成当前单据的单据编号。

**进货单明细**

| 字段          | 说明                                             |
|---------------|--------------------------------------------------|
| 条形码	参见条形码
| 项目	参见项目档案
| 供应商存货
| 存货	参见存货档案 属性为‘外购、劳务费用’的存货记录
| 规格型号	 
| 行业字段
| 仓库	业务与仓库合并 或 进货单自动生成入库单时，不可空。
| 采购单位	实际业务发生时的计量单位
| 数量	采购单位的数量，退货时小于0
| 损耗数量	采购单位对应的损耗数量。业务与仓库分开流程时有此字段。
| 计量单位组合	参见多计量
| 计量单位2	 
| 数量2	 
| 损耗数量2	 
| 换算率	 
| 单价2	业务与仓库合并时，有此字段。参见采购入库单描述对应[计量单位2]的单价。
| 报价	 
| 折扣%	 
| 税率%
| 单价	 
| 含税单价	 
| 金额	 
| 税额	 
| 含税金额	普通采购的进货单，允许整单总额<0，但本单至少要有一条为正数行，覆盖频繁换货且长期合作关系且业务量大的需求。
| 折扣金额	 
| 本币单价	参见多币种
| 本币金额	 
| 本币税额	 
| 本币含税单价	 
| 本币含税金额	 
| 本币折扣金额	 
| 本币单价2	 
| 入库单号	对于个别计价的存货，退货时，根据选择的入库单确定成本。当环节合并和进货单自动生成入库单时必选。<br/> 对于个别计价的存货，退货时，根据选择的入库单确定成本。
| 到货日期	 
| 赠品	参见赠品管理
| 普通退货数量	 
| 普通退货数量2	 
| 冲抵退货数量	 
| 冲抵退货数量2	 
| 批号	参见批号管理 当业务与仓库合并或进货单自动生成入库单时非空。
| 生产日期	当失效日期不空时
| 保质期	引用存货档案
| 失效日期	参见有效期管理
| 应收数量	业务与仓库合并时才显示此字段。
| 应收数量2	参见入库单栏目
| 货位	参见货位管理  参照入库单生单时，不带入货位。
| 销售订单号	用于销售订单跟踪业务，未自动带入时，可手工指定。
| 来源单据	流转生成当前单据的单据类型。有采购订单、采购入库单。
| 来源单号	流转生成当前单据的单据编号

## 业务规则

+ 新增
  - 手工新增
  - 由采购订单生成进货单
    存在已生效未中止的采购订单。  
    采购订单上没有停用的供应商。  
    存在尚未生成过入库单的订单明细行。  
    如果“超订单进货/入库”选项为“是”，则订单明细存货的数量流转不控制，如果订单可执行量（数量-累计进货数量）小于等于零，则带入零；如果“超订单进货/入库”选项为“否”，则只有订单（数量-累计进货数量）>0明细行存货才可转为进货单。  
    当前操作员对采购订单上供应商、部门、业务员、存货有数据权限。  
  - 由采购入库单生成进货单
    存在已生效的采购入库单。  
    存在不是参照进货单生成的入库单。  
    存在表体存货未停用且未全部流转成进货单的采购入库单明细行。  
    采购入库单上没有停用的供应商、仓库。  
    存在当前操作员对采购入库单上的供应商、部门、业务员、表体仓库、存货 有数据权限的采购入库单明细行。  

+ 状态
  - 已审	单据有审核环节时，有此状态，表示单据已经审核。
  - 已入库	进货单所有存货的数量已全部入库
  - 已结清	进货单所有存货与供应商已全部结账。进货单立账时有此状态。

+ 删除
  - 如果业务与仓库合并，删除成功后需要清除库存账。
  - 删除成功后，不删除本单已进行价格跟踪的最新进价。

+ 生单
  - 进货单（采购退货）、采购入库单（普通采购）、采购入库单（采购退货）、生成采购发票（普通采购）、生成采购发票（采购退货）
  - 自动生成采购发票
    进货单票据类型为“收据”之外的票据类型。
    表体不是正负混录的进货单，正负混录的进货单不能自动生成发票。
    普通采购的进货单生成普通采购的采购发票；采购退货的进货单生成采购退货的发票。
    自动生成的发票可以修改、删除。
    退货业务时	冲抵进货的退货单不能自动生成发票
  - 自动生成采购入库单
    采购选项“进货单自动生成入库单”选项为“是”。
    来源单不是“采购入库单”的进货单。
  - 正负混录进货单按数量正负方向自动分单生成2张采购入库单。数量为正数的生成业务类型为“普通采购”的采购入库单，数量为负数的生成业务类型为“采购退货”的采购入库单

+ 生效
  - 启用了批号管理、有效期管理、货位管理、行业特性后，存货仓库、批号、失效日期、行业字段不可为空
  - 可用量、现存量、最高最低库存量、货位结存量控制
  - 合并流程进货单生效时，用本币单价（主计量）、本币金额、数量（主计量）、计量单位（主计量）来登库存账。
  - 当业务与仓库分开且进货单不自动生成采购入库单时，在进货单上不能指定货位。
    当业务与仓库合并时对于进行货位管理的仓库，在进货单上要指定货位
    进货单无审核环节时，保存前要指定货位。
    进货单有审核环节时，审核前要指定货位。
    当进货单自动生成采购入库单时，如果采购入库单没有审核环节：进货单有审核环节，则在进货单审核前要指定货位；进货单无审核环节，则在进货单保存时要指定货位。
    当进货单自动生成采购入库单时，如果采购入库单有审核环节，则在进货单上可以不指定货位。

+ 冲抵进货
  - 当进货单自动生成采购入库单时，“冲抵进货”无效。
  - 参照进货单退货时，冲抵原进货单数量，冲抵部分不再做入库、开票、付款。

+ 变更
  - 只能改备注和扩展字段。

+ 现结处理
  - 若现结金额、使用预付不为空，则进货单生效时，自动生成一张付款单，预付冲应付单，并进行自动核销。当|现结金额|>|原币含税金额的合计|-|使用预付|时，多余的部分会转收预付款单。
  - |使用预付|<=|原币含税金额的合计|。
  - 业务类型为‘普通采购’，现结明细行现结金额只能大于零；业务类型为‘采购退货’，现结明细行金额只能小于零，现结明细不可- 正负金额混录。
  - 扣除现结金额后的整单总金额记应付账。
  - 当进货单没有审核环节时，修改与付款单相关项时，付款单要同时自动修改。

+ 金额字段权限
  - 报价、单价、含税单价、金额、含税金额、折扣额、本币单价、本币金额、本币税额、本币含税单价、本币含税金额、现结金额、结款金额 、单价2、本币单价2、使用预付。
